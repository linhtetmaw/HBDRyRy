<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy RyRy Day & Your Gift!</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <!-- Tone.js CDN for audio synthesis -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* Custom CSS for a festive background and font */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); /* Warm gradient background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden; /* Prevent horizontal scroll */
            overflow-y: auto;   /* Allow vertical scroll */
        }

        /* Simple confetti effect (pure CSS) */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ffd700; /* Gold */
            opacity: 0;
            animation: confetti-fall linear infinite;
        }

        .confetti:nth-child(2n) { background-color: #ff6347; /* Tomato */ }
        .confetti:nth-child(3n) { background-color: #4682b4; /* SteelBlue */ }
        .confetti:nth-child(4n) { background-color: #32cd32; /* LimeGreen */ }
        .confetti:nth-child(5n) { background-color: #8a2be2; /* BlueViolet */ }

        @keyframes confetti-fall {
            0%, 100% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Overlay for sound activation */
        #audioEnableOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensure it's on top */
            transition: opacity 0.5s ease-out;
        }

        #audioEnableOverlay.hidden {
            opacity: 0;
            pointer-events: none; /* Disable clicks when hidden */
        }
    </style>
</head>
<body class="selection:bg-pink-300 selection:text-pink-900">
    <!-- Confetti elements -->
    <div class="confetti" style="left: 10%; animation-duration: 5s; animation-delay: 0s;"></div>
    <div class="confetti" style="left: 25%; animation-duration: 7s; animation-delay: 1s;"></div>
    <div class="confetti" style="left: 40%; animation-duration: 6s; animation-delay: 0.5s;"></div>
    <div class="confetti" style="left: 55%; animation-duration: 8s; animation-delay: 2s;"></div>
    <div class="confetti" style="left: 70%; animation-duration: 5.5s; animation-delay: 1.5s;"></div>
    <div class="confetti" style="left: 85%; animation-duration: 6.5s; animation-delay: 0.2s;"></div>
    <div class="confetti" style="left: 15%; animation-duration: 7.2s; animation-delay: 0.8s;"></div>
    <div class="confetti" style="left: 30%; animation-duration: 6.8s; animation-delay: 1.8s;"></div>
    <div class="confetti" style="left: 45%; animation-duration: 5.9s; animation-delay: 0.3s;"></div>
    <div class="confetti" style="left: 60%; animation-duration: 7.5s; animation-delay: 1.2s;"></div>

    <!-- Audio Enable Overlay -->
    <div id="audioEnableOverlay">
        <button id="enableAudioButton" class="px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold text-xl rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-75">
            üéµ Tap to Enable Sound & Start! üéµ
        </button>
    </div>

    <!-- Birthday Wish Section -->
    <div id="birthdayWishSection" class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl text-center max-w-sm mx-auto transform hover:scale-105 transition-transform duration-300 ease-in-out border-4 border-pink-400">
        <div class="text-6xl mb-4 animate-bounce-slow">üéâ</div>

        <!-- Placeholder for birthday girl's photo -->
        <img src="https://placehold.co/150x150/FFC0CB/FFFFFF?text=RyRy" alt="Birthday Girl" class="rounded-full mx-auto mb-6 shadow-lg border-4 border-pink-300 object-cover w-32 h-32 md:w-40 md:h-40">

        <h1 class="text-4xl md:text-5xl font-extrabold text-pink-600 mb-4 tracking-tight">
            Happy RyRy Day!
        </h1>
        <p class="text-lg md:text-xl text-gray-700 leading-relaxed mb-6">
            Wishing you a day filled with joy, laughter, and everything that makes you happy.
            May your year ahead be even brighter!
        </p>
        <p class="text-md md:text-lg font-semibold text-pink-500">
            Best wishes,
            <br>
            Lin
        </p>
        <!-- Cake emoji made clickable to show gift card section -->
        <a href="#" id="giftButton" class="inline-block text-6xl mt-6 animate-bounce-slow cursor-pointer no-underline">üéÇ</a>
        <p class="text-sm md:text-base text-gray-600 mt-2">Click Cake to check your birthday present.</p>

        <!-- Play Birthday Song Button -->
        <button id="playSongButton" class="mt-8 px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-75">
            üéµ Replay Birthday Song üéµ
        </button>
    </div>

    <!-- Gift Card Section (initially hidden) -->
    <div id="giftCardSection" class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl text-center max-w-sm mx-auto transform hover:scale-105 transition-transform duration-300 ease-in-out border-4 border-green-400 hidden">
        <h1 class="text-4xl md:text-5xl font-extrabold text-green-600 mb-6 tracking-tight">
            Here's Your Gift!
        </h1>

        <!-- Gift Card Image Frame - Vertical -->
        <div class="relative w-64 h-96 mx-auto mb-8 bg-gray-100 rounded-xl shadow-lg border-4 border-dashed border-gray-300 p-4 overflow-hidden flex items-center justify-center">
            <img src="https://placehold.co/200x300/E0F2F7/000000?text=Your+Gift+Card+Here" alt="Gift Card Placeholder" class="w-full h-full rounded-lg object-cover shadow-md">
            <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 text-white font-bold text-xl opacity-0 hover:opacity-100 transition-opacity duration-300 rounded-lg">
                Upload Your Gift Card Image!
            </div>
        </div>

        <!-- Gift Card Code Section -->
        <div class="mb-8 p-4 bg-yellow-100 rounded-lg border border-yellow-300 shadow-inner">
            <p class="text-lg font-semibold text-yellow-800 mb-2">Your Gift Code:</p>
            <div id="giftCode" class="text-2xl md:text-3xl font-mono font-bold text-gray-800 break-all mb-4 select-all">
                GIFT-RYRY-2025-ABCD
            </div>
            <button id="copyCodeButton" class="px-6 py-2 bg-yellow-500 text-white font-bold rounded-full shadow-md hover:bg-yellow-600 transition duration-200 ease-in-out">
                Copy Code
            </button>
            <span id="copyMessage" class="ml-3 text-sm text-green-700 opacity-0 transition-opacity duration-300">Copied!</span>
        </div>

        <button id="backToWishButton" class="inline-block px-6 py-3 bg-gradient-to-r from-blue-500 to-teal-500 text-white font-bold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
            ‚Üê Back to Birthday Wish
        </button>
    </div>

    <script>
        // Get references to the sections
        const birthdayWishSection = document.getElementById('birthdayWishSection');
        const giftCardSection = document.getElementById('giftCardSection');
        const giftButton = document.getElementById('giftButton');
        const backToWishButton = document.getElementById('backToWishButton');
        const playSongButton = document.getElementById('playSongButton');
        const copyCodeButton = document.getElementById('copyCodeButton');
        const giftCodeElement = document.getElementById('giftCode');
        const copyMessage = document.getElementById('copyMessage');
        const audioEnableOverlay = document.getElementById('audioEnableOverlay');
        const enableAudioButton = document.getElementById('enableAudioButton');

        // Simple animation for the bounce effect on emojis
        const emojis = document.querySelectorAll('.animate-bounce-slow');
        emojis.forEach(emoji => {
            emoji.style.animation = 'bounce 2s infinite ease-in-out';
        });

        // Adjust confetti count for better visual effect on different screens
        window.addEventListener('resize', () => {
            const confettiElements = document.querySelectorAll('.confetti');
            confettiElements.forEach(confetti => {
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDuration = (Math.random() * 3 + 4) + 's'; // 4-7 seconds
                confetti.style.animationDelay = (Math.random() * 2) + 's'; // 0-2 seconds
            });
        });

        // Initial confetti positioning
        window.dispatchEvent(new Event('resize'));

        // Function to play the birthday song
        async function playBirthdaySong() {
            // Create a synth
            const synth = new Tone.Synth().toDestination();

            // Define the "Happy Birthday" melody (notes and durations)
            const melody = [
                { time: '0:0:0', note: 'C4', duration: '8n' }, { time: '0:0:1', note: 'C4', duration: '8n' }, { time: '0:0:2', note: 'D4', duration: '4n' },
                { time: '0:1:0', note: 'C4', duration: '4n' }, { time: '0:1:2', note: 'F4', duration: '4n' }, { time: '0:2:0', note: 'E4', duration: '2n' },
                { time: '0:3:0', note: 'C4', duration: '8n' }, { time: '0:3:1', note: 'C4', duration: '8n' }, { time: '0:3:2', note: 'D4', duration: '4n' },
                { time: '0:4:0', note: 'C4', duration: '4n' }, { time: '0:4:2', note: 'G4', duration: '4n' }, { time: '0:5:0', note: 'F4', duration: '2n' },
                { time: '0:6:0', note: 'C4', duration: '8n' }, { time: '0:6:1', note: 'C4', duration: '8n' }, { time: '0:6:2', note: 'C5', duration: '4n' },
                { time: '0:7:0', note: 'A4', duration: '4n' }, { time: '0:7:2', note: 'F4', duration: '4n' }, { time: '0:8:0', note: 'E4', duration: '8n' },
                { time: '0:8:1', note: 'D4', duration: '2n' },
                { time: '0:9:0', note: 'Bb4', duration: '8n' }, { time: '0:9:1', note: 'Bb4', duration: '8n' }, { time: '0:9:2', note: 'A4', duration: '4n' },
                { time: '0:10:0', note: 'F4', duration: '4n' }, { time: '0:10:2', note: 'G4', duration: '4n' }, { time: '0:11:0', note: 'F4', duration: '2n' }
            ];

            // Set the overall tempo (BPM - Beats Per Minute)
            Tone.Transport.bpm.value = 80; // Reduced from default 120 to 80 for slower playback

            // Calculate the total duration of the melody
            const totalMelodyDuration = Tone.Time('0:12:0').toSeconds(); // Approximately 12 measures for the whole song

            // Create a Tone.Part to play the melody
            const part = new Tone.Part((time, value) => {
                synth.triggerAttackRelease(value.note, value.duration, time);
            }, melody).start(0);

            // Set the part to loop 2 times (total 3 plays: initial + 2 loops)
            part.loop = 2; // Plays the melody 3 times in total (original + 2 repetitions)
            part.loopEnd = totalMelodyDuration; // Set the loop end to the total duration of the melody

            // Start the Tone.Transport to begin playback
            Tone.Transport.start();
        }

        // Event listener for the initial "Enable Sound" button
        // Changed to 'touchstart' for better mobile compatibility
        enableAudioButton.addEventListener('touchstart', async (event) => {
            event.preventDefault(); // Prevent potential double-tap issues
            console.log('Touchstart detected on enableAudioButton');

            // Start Tone.js audio context and resume if suspended
            try {
                await Tone.start();
                if (Tone.context.state !== 'running') {
                    await Tone.context.resume();
                    console.log('Audio context resumed.');
                }
                console.log('Audio context state:', Tone.context.state);

                // Hide the overlay
                audioEnableOverlay.classList.add('hidden');

                // Play the song immediately after enabling audio with a small delay
                // This delay can sometimes help ensure the audio engine is fully ready
                setTimeout(() => {
                    playBirthdaySong();
                }, 100); // 100ms delay

            } catch (error) {
                console.error('Error starting/resuming audio context:', error);
                // Optionally, display a message to the user if audio fails to start
            }
        });

        // Event listener for the "Replay Birthday Song" button
        playSongButton.addEventListener('click', () => {
            // Ensure audio context is running (it should be after the initial tap)
            if (Tone.context.state !== 'running') {
                Tone.context.resume().then(() => {
                    console.log('Audio context resumed for replay.');
                    playBirthdaySong();
                }).catch(error => {
                    console.error('Error resuming audio context for replay:', error);
                });
            } else {
                playBirthdaySong();
            }
        });

        // Function to show the gift card section and hide the birthday wish section
        giftButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default link behavior
            birthdayWishSection.classList.add('hidden');
            giftCardSection.classList.remove('hidden');
            // Change background color for gift card section
            document.body.style.background = 'linear-gradient(135deg, #a7e9af 0%, #83a4d4 100%)';
        });

        // Function to show the birthday wish section and hide the gift card section
        backToWishButton.addEventListener('click', function() {
            giftCardSection.classList.add('hidden');
            birthdayWishSection.classList.remove('hidden');
            // Change background color back to birthday wish section
            document.body.style.background = 'linear-gradient(135deg, #f6d365 0%, #fda085 100%)';
        });

        // Copy Gift Code functionality
        copyCodeButton.addEventListener('click', function() {
            const giftCode = giftCodeElement.textContent.trim();
            const tempInput = document.createElement('textarea');
            tempInput.value = giftCode;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                document.execCommand('copy');
                copyMessage.style.opacity = '1';
                setTimeout(() => {
                    copyMessage.style.opacity = '0';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
                copyMessage.textContent = 'Failed to copy!';
                copyMessage.style.color = 'red';
                copyMessage.style.opacity = '1';
                setTimeout(() => {
                    copyMessage.style.opacity = '0';
                    copyMessage.style.color = '';
                    copyMessage.textContent = 'Copied!';
                }, 2000);
            } finally {
                document.body.removeChild(tempInput);
            }
        });
    </script>
</body>
</html>
